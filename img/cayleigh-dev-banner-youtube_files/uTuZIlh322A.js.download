;/*FB_PKG_DELIM*/

__d("LSDeleteThreadCentricMessages",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(12).fetch([[[a[0],{lte:a[1]}]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteThreadCentricMessagesStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSHandleRepliesOnRemove",["LSDeleteMessage"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.sequence([function(d){return c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"replySourceIdMessageID"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.replySourceId===a[1]&&c.i64.eq(b.replyType,c.i64.cast([0,1]))}),function(a){a=a.item;return c.storedProcedure(b("LSDeleteMessage"),a.threadKey,a.messageId)})},function(b){return c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"replySourceIdMessageID"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.replySourceId===a[1]}),function(a){var b=a.item;return c.forEach(c.filter(c.db.table(12).fetch([[[b.threadKey,b.timestampMs,b.messageId]]]),function(a){return c.i64.eq(a.threadKey,b.threadKey)&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(a.timestampMs,b.timestampMs)&&a.messageId===b.messageId}),function(a){var b=a.update;a.item;return b({replySourceId:void 0,replySourceTimestampMs:void 0,replySourceType:void 0,replySourceTypeV2:void 0,replySnippet:void 0,replyStatus:void 0,replyToUserId:void 0,replyMessageText:void 0,replyMediaExpirationTimestampMs:void 0,replyMediaUrl:void 0,replyMediaUrlFallback:void 0,replyMediaPreviewWidth:void 0,replyMediaPreviewHeight:void 0,replyMediaUrlMimeType:void 0,replyAttachmentType:void 0,replyAttachmentId:void 0,replyAttachmentExtra:void 0})})})}])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSMailboxHandleRepliesOnRemoveStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSRefreshLastActivityTimestamp",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(d){return b.db.table(12).fetchDesc([[[a[0]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=b.i64.cast([0,0]):(d=a.item,c[0]=d.timestampMs)})},function(d){return b.db.table(9).fetch([[[a[0]]]]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[2]=b.i64.cast([0,0]):(d=a.item,c[2]=d.lastActivityTimestampMs)})},function(d){return b.i64.neq(c[0],b.i64.cast([0,0]))&&b.i64.neq(c[0],c[2])?b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({lastActivityTimestampMs:c[0]})}):b.resolve()}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxRefreshLastActivityTimestampStoredProcedure";a.__tables__=["messages","threads"];e.exports=a}),null);
__d("LSUpdateSelectiveSyncState",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.filter(b.db.table(9).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&([b.i64.cast([0,23]),b.i64.cast([0,21]),b.i64.cast([0,18]),b.i64.cast([0,26]),b.i64.cast([0,27])].some(function(a){return b.i64.eq(c.threadType,a)})||b.i64.eq(c.threadType,b.i64.cast([0,152])))}).next().then(function(c,d){d=c.done;c=c.value;return d?b.db.table(294).add({threadKey:a[0],threadQueueSequenceId:b.i64.cast([0,0]),lastSelectiveSyncTimestampMs:a[1]}):(c.item,b.forEach(b.db.table(294).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({lastSelectiveSyncTimestampMs:a[1]})}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateSelectiveSyncStateStoredProcedure";a.__tables__=["threads","community_thread_sync_info"];e.exports=a}),null);
__d("LSUpsertThreadMemberCount",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(9).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({memberCount:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertThreadMemberCountStoredProcedure";a.__tables__=["threads"];e.exports=a}),null);
__d("LSUpsertTpqTtrc",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(286).put({threadKey:a[0],dasmExecutionTimestampMs:c[0],deltaInsertionTimestampMs:a[1],status:a[2]})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxUpsertTpqTtrcStoredProcedure";a.__tables__=["thread_point_query_ttrc"];e.exports=a}),null);